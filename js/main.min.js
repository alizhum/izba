const filterToggle = document.querySelectorAll('.filter-toggle');
const saveRoute = document.querySelector('.event-card button.save');


const currentPath = window.location.pathname.split("/").pop(); // Get current path
const categoryList = document.querySelector('.categories');

  if( categoryList ) {
    const links = categoryList.getElementsByTagName('a');
    for (let link of links) {
      const linkPath = link.getAttribute('href');
      if (currentPath === linkPath) {
          link.classList.add('active');
      }
    }
  }

searchForm();

function searchForm() {
  const searchField = document.querySelector('.search .form-field');
  const clearButton = document.querySelector('.search .search-clear');

  if (searchField.value.length > 0) clearButton.classList.add('show');

  searchField.addEventListener('input', function() {
    if (this.value.length > 0) {
      clearButton.classList.add('show');
    } else {
      clearButton.classList.remove('show');
    }
  });

  clearButton?.addEventListener('click', function() {
    searchField.value = '';
    clearButton.classList.remove('show');
    searchField.dispatchEvent(new Event('input'));
  });
}


saveRoute?.addEventListener('click', function(e) {

  this.classList.toggle('active');

});

filterToggle?.forEach((button) => {

  button.addEventListener('click', function() {

    document.getElementById('filter-form').classList.toggle('active');
    this.classList.toggle('active');
    document.body.classList.toggle('overflow-hidden');
  
  });

});


document.body.addEventListener('click', function(e) {

  if( e.target.classList.contains('filter-content') ) {

    document.querySelector('.filter-toggle').click();

  }

});


tabsInit();
customSelect();




const introSlider = new Swiper('.card-slider', {
  slidesPerView: 'auto',
  spaceBetween: 20,
  pagination: {
    el: '.card-slider-pagination',
    clickable: true
  }
});


function tabsInit() {

  const tabButtons = document.querySelectorAll('.tab-button');

  tabButtons?.forEach(function(button) {

    button.addEventListener('click', function() {
  
      if( this.classList.contains('active') ) return;
  
      const tab = this.closest('.tab');
      const contentID = this.dataset.content;
      const activeContent = tab.querySelector('.tab-content.active');
      const activeButton = tab.querySelector('.tab-button.active');
      const contentToActive = document.getElementById(contentID);
      
  
      if( contentToActive ) {
  
        activeContent.classList.remove('active');
        activeButton.classList.remove('active');
  
        this.classList.add('active');
        contentToActive.classList.add('active');
  
      }
  
    });
  });
}

// Custom select
function customSelect() {
  const items = document.querySelectorAll('.select');

  if( !items ) return;

  items.forEach((item) => {

    const select = item.querySelector('select');
    const options = item.querySelectorAll('option');
    if( !options ) return;

    const current = document.createElement('div');
    current.classList.add('select-current');

    const ul = document.createElement('ul');
    ul.classList.add('select-list');

    options.forEach((option) => {
      
      const li = document.createElement('li');
      li.textContent = option.textContent;
      li.setAttribute('data-value', option.getAttribute('value'));
      li.classList.add('select-item');

      if( option.getAttribute('value') == select.value ) {
        li.classList.add('current');
        current.textContent = option.textContent;
      }
      
      ul.appendChild(li);

    });

    item.appendChild(current);
    item.appendChild(ul);

    select.addEventListener('change', function() {

      let value = !this.value ? '""' : this.value;
      let curr = ul.querySelector('li[data-value='+value+']');

      if( curr ) {

        ul.querySelector('.current').classList.remove('current');
        curr.classList.add('current');
        current.textContent = curr.textContent;
      }

      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server


    });

    current.addEventListener('click', function() {
      this.closest('.select').classList.toggle('active');
    });

    const listItems = ul.querySelectorAll('li');

    listItems.forEach((item) => {

      item.addEventListener('click', function() {
        
        if( this.classList.contains('current') ) return;

        ul.querySelector('.current').classList.remove('current');
        this.classList.add('current');
        select.value = this.dataset.value;
        current.textContent = this.textContent;

        current.closest('.active').classList.remove('active');

        select.dispatchEvent(new Event('change'));

      });

    });

    // Close dropdonw when clicked outside
    document.addEventListener('click', function(e) {
      
      if(!item.contains(e.target)) {
        item.classList.remove('active');
      }
    });


  });

}

